# 컨테이너
- 리눅스 네임스페이스, cgroup, 때때로 CoW 파일시스템을 사용해 어플리케이션 수준의 종속성 관리를 제공하는 리눅스 프로세스 그룹으로 이해.
- 로컬 테스트와 개발부터 분산 시스템 작업(예: k8s)에 이르기까지 다양

### OCI(Open Container Initiative)
- 런타임 사양
  - 운영과 수명주기 단계를 포함해 런타임이 지원해야 하는것에 대한 정의
- 이미지 형식 사양
  - 메타데이터와 계층을 기반으로 컨테이너 이미지가 구성되는 방식을 정의
- 배포 사양
  - 컨테이너 이미지가 전달되는 방식, 컨테이너와 관련해 저장소가 효과적으로 동작하룻 있는 방식ㅇ 정의

### 불변성(Immutability)
- 한 번 구성되면 사용 중에 변경할 수 없다.
- 변경하려면 새로운 구성과 새 리소스(예: 프로세스)를 생성해야 한다.

## 리눅스 네임스페이스
- 리눅스는 리소스에 대한 전역 뷰(global view)를 가지고 있었다.
- 프로세스가 리소스(파일시스템, 네트워킹, 사용자)에 대한 로컬 뷰(local view) 가질 수 있도록 리눅스는 네임스페이스를 도입했다.
- 리눅스 네임스페이스는 모두 리소스 가시성에 관한 것. 운영체제 리소스의 다양한 측면을 프로세스 간의 가시성을 격리하는 데 사용

### clone
- 실행 컨텍스트의 일부를 부모 프로세스와 공유할 수 있는 자식 프로세스를 생성하는 데 사용
### unshare
- 기존 프로세스에서 공유된 실행 컨텍스트를 제거하는 데 사용
### setns
- 기존 프로세스를 기존 네임스페이스에 결합하는 데 사용

## 리눅스 cgroup
- 네임스페이스가 프로세스간 가시성에 관한 것이라면, cgroup 은 프로세스 그룹을 구성하는 메커니즘이다. cgroup 을 계층 구조와 함께 사용하면 시스템 리소스 사용을 제어할 수 있고, 리소스 사용 추적이 가능하다.
예를 들어, 프로세스 혹은 프로세스 그룹이 RAM, CPU 시간을 얼마나 사용 중인지 확인 가능하다.
### cgroup v1
- CFS 대역폭 제어: cpu cgroup 을 통해 사용
- CPU 사용량 정산 컨트롤러
- cpusets cgroup: 작업에 cpu와 메모리 할당 가능
- 메모리 리소스 컨트롤러: 작업의 메모리 동작 분리 가능
- 디바이스 화이트리스트 콘트롤러: 디바이스 파일 사용 제어
- freezer cgroup: 배치 작업 관리에 사용
- 네트워크 분류기: 패킷에 다른 우선 순위를 할당하는 데 사용
- 블록 I/O 콘트롤러
- perf_event 명령: 성능 데이터 수집
- 네트워크 우선순위: 트래픽 우선 순위를 동적으로 설정
- HugeTLB 컨트롤러: HugeTLB 사용 제한
- 프로세스 번호 컨트롤러: 특정 제한에 도달 후 cgroup 계층이 새 프로세스 생성을 중지시킬 때 사용
### cgroup v2
- v1 에서 배운 교훈을 바탕으로 완전히 다시 작성. 단일 계층 구조만 가지며 모든 컨트롤러가 동일한 방식으로 관리된다.
- CPU 컨트롤러: CPU 주기의 분산을 제어. 다양한 모델(weight, max) 지원하고 사용량 보고를 포함
- 메모리 컨트롤러: 사용자 공간 메모리, 덴트리(dentry) 와 아이도 같은 커널 데이터 구조, TCP 소켓 버퍼를 지원하는 다양한 제어 매개변수로 메모리 분산을 제어
- I/O 컨트롤러: 가중치 기반과 절대 대역폭, 혹은 IOPS(초당 I/O 작업) 제한으로 I/O 리소스의 분산을 제어하고 바이트와 IOPS 읽기/쓰기에 대해 보고
- PID 컨트롤러: v1 과 유사
- device 컨트롤러: eBPF 위에 구현된 디바이스 파일에 대한 접근을 관리
- rdma 컨트롤러: RDMA(remote direct memory access) 리소스의 분산과 연산을 제어
- HugeTLB 컨트롤러: v1 과 유사
## CoW filesystem
- 빌드 시 사용되며, 애플리케이션과 모든 종속성을 배포 가능한 독립 파일 하나로 패키징한다. 주로 바인드 마운트와 함께 사용되어 종속성이 서로 다른 콘텐츠를 효율적인 방식으로 계층화한다.
## Docker
- 프로그램과 종송석을 쉽게 패키징
- 실질적인 디렉토리인 JSON 파일과 계층의 메타데이터를 포함하는 압축된 아카이브 파일. 도커 데몬은 필요에 따라 컨테이너 레지스트리에서 컨테이너 이미지를 가져옴
- 도커 데몬은 네임스페이스와 cgroup 을 통해서 컨테이너를 관리한다.
### 컨테이너 이미지
- 실질적인 디렉토리인 JSON 파일과 계층의 메타데이터를 포함하는 압축된 아카이브 파일. 데몬은 필요할 경우 레지스트리에서 이미지를 가져온다.
- Dockerfile 이라 불리는 일반 텍스트 파일 형식을 사용하여 빌드하며, 실행하게 배포할 수 있는 아티팩트.
### 런타임 아티팩트로서의 컨테이너
- 런타임 아티팩트로서의 컨테이너 : 시작, 중지, 종료, 제거 가능. 도커 데몬과의 상호 작용 시 CLI(docker) 명령어를 사용.
## 다른 컨테이너 도구
### 레드햇 주도의 podman, buildah
데몬이 없는 도구를 사용ㄹ해도 OCI 컨테이너 이미지를 빌드(builda)하고 실행(podman)할 수 있다.